<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>表单练习</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <script src="/js/jquery-3.6.0.min.js" type="text/javascript"></script>
    <script src="/js/bootstrap.min.js" type="text/javascript"></script>
</head>
<body>
<!-- Button trigger modal -->
<button type="button" id="model_btn" class="btn btn-primary btn-lg">
    你过来啊
</button>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document" style="width:500px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">用户添加</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="myform">
                    <div class="form-group">
                        <label for="username" class="col-sm-2 control-label">用户名</label>
                        <div class="col-sm-9">
                            <input type="text" name="username" class="form-control" id="username" placeholder="请输入用户名">
                            <span class="help-block"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="password" class="col-sm-2 control-label">密码</label>
                        <div class="col-sm-9">
                            <input type="password" name="password" class="form-control" id="password"
                                   placeholder="请输入密码">
                            <span class="help-block"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">性别</label>
                        <div class="col-sm-10">
                            <label class="radio-inline">
                                <input type="radio" name="gender" value="1" checked="checked">男
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="gender" value="0">女
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">爱好</label>
                        <div class="col-sm-5">
                            <select class="form-control" name="did">
                                <option value="0">吃</option>
                                <option value="1">喝</option>
                                <option value="2">拉</option>
                                <option value="3">撒</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="save">保存</button>
            </div>
        </div>
    </div>
</div>

<script>
    //弹框
    $("#model_btn").click(function () {

        //获取下拉框数据

        //清除表单数据
        resetForm("#myform");
        //点击其他区域模态框不会消失
        $("#myModal").modal({
            backdrop: "static"
        });
    });

    //清空表单样式及内容
    function resetForm(element) {
        $(element)[0].reset();
        $(element).find("*").removeClass("has-error has-success");
        $(element).find(".help-block").text("");
    }

    //保存提交
    $("#save").click(function () {

        //用户名已存在禁止保存
        if ($(this).attr("btnState") == "error") {
            return false;
        }

        //校验未通过禁止保存
        if (!checkForm()) {
            return false;
        }

        $.ajax({
            url: "",
            type: "post",
            data: $("#myform").serialize(),
            success: function (result) {
                //关闭模态框
                $('#myModal').modal('hide')
            }
        });
    });

    //校验用户名是否存在
    $("#username").change(function () {
        var username = this.value;
        $.ajax({
            url: "",
            type: "post",
            dataType: "json",
            data: {
                "username": username
            },
            success: function (result) {
                if (result.status == 500) {
                    checkMessage("#username", "error", "用户名已存在");
                    //保存按钮不可用
                    $("#save").attr("btnState", "error");
                } else {
                    checkMessage("#username", "success", "");
                    $("#save").attr("btnState", "success");
                }
            }
        });
    });

    //用户名框失去焦点事件
    $("#username").blur(function () {
        var username = $("#username").val();
        var regname = /^[a-zA-Z0-9_-]{3,16}$/;
        if (username == '') {
            checkMessage("#username", "error", "用户名不能为空")
            return false;
        } else if (!regname.test(username)) {
            checkMessage("#username", "error", "用户名是3到16位的大小写字母、数字、下划线组合")
            return false;
        } else
            checkMessage("#username", "success", "")
    });

    //密码框失去焦点事件
    $("#password").blur(function () {
        var password = $("#password").val();
        var regPwd = /^[a-zA-Z0-9_-]{6,18}$/;
        if (password == '') {
            checkMessage("#password", "error", "密码不能为空")
            return false;
        } else if (!regPwd.test(password)) {
            checkMessage("#password", "error", "密码是6到18位的大小写字母、数字、下划线组合")
            return false;
        } else
            checkMessage("#password", "success", "")
    });

    //封装校验提示信息
    function checkMessage(element, status, msg) {
        //清除元素校验状态
        $(element).parent().removeClass("has-success has-error");
        if (status == "success") {
            $(element).parent().addClass("has-success");
            $(element).next("span").text(msg);
        } else {
            $(element).parent().addClass("has-error");
            $(element).next("span").text(msg);
        }
    }

    //用户名校验
    function checkName() {
        var username = $("#username").val();
        var regname = /^[a-zA-Z0-9_-]{3,16}$/;
        if (username == '') {
            checkMessage("#username", "error", "用户名不能为空")
            return false;
        } else if (!regname.test(username)) {
            checkMessage("#username", "error", "用户名是3到16位的大小写字母、数字、下划线组合")
            return false;
        } else
            checkMessage("#username", "success", "")
    }

    //密码校验
    function checkPwd() {
        var password = $("#password").val();
        var regPwd = /^[a-zA-Z0-9_-]{6,18}$/;
        if (password == '') {
            checkMessage("#password", "error", "密码不能为空")
            return false;
        } else if (!regPwd.test(password)) {
            checkMessage("#password", "error", "密码是6到18位的大小写字母、数字、下划线组合")
            return false;
        } else
            checkMessage("#password", "success", "")
    }

    //表单信息校验
    function checkForm() {
        if (checkName() & checkPwd()) {
            return true;
        } else
            return false;
    }

    //失去焦点事件
    //$("#username").blur(function () {
    //    var username = $("#username").val();
    //    var regName = /^[a-zA-Z0-9_-]{3,16}$/;
    //    if (username == '') {
    //        $("#myModalLabel").text("用户名不能为空").css("color", "red");
    //        return false;
    //    }else if (!regName.test(username)) {
    //        $("#myModalLabel").text("用户名是6到16位的字母、数字、下划线组合").css("color", "red");
    //        return false;
    //    } else
    //        return true;
    //});

    //失去焦点事件
    //$("#password").blur(function () {
    //    var password = $("#password").val();
    //    var regPwd = /^[a-z0-9_-]{6,18}$/;
    //    if (password == '') {
    //        $("#myModalLabel").text("密码不能为空").css("color", "red");
    //        return false;
    //    } else if (!regPwd.test(password)) {
    //        $("#myModalLabel").text("密码是6到18位的字母、数字、下划线组合").css("color", "red");
    //        return false;
    //    } else
    //        return true;
    //});


    //得到焦点事件
    //$("input").focus(function () {
    //    $("#mymodallabel").text("用户添加").css("color", "black");
    //});


</script>
</body>
</html>